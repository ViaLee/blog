<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React | ğŸ’«Viaã®blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/babe.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.a509abab.css" as="style"><link rel="preload" href="/assets/js/app.6a1e7b57.js" as="script"><link rel="preload" href="/assets/js/2.f7f94fda.js" as="script"><link rel="preload" href="/assets/js/8.74f87bb3.js" as="script"><link rel="prefetch" href="/assets/js/10.94991a2c.js"><link rel="prefetch" href="/assets/js/11.dc2a681f.js"><link rel="prefetch" href="/assets/js/12.8ba7a12f.js"><link rel="prefetch" href="/assets/js/13.515533ed.js"><link rel="prefetch" href="/assets/js/14.45f6d6ea.js"><link rel="prefetch" href="/assets/js/15.a540c83c.js"><link rel="prefetch" href="/assets/js/16.01649045.js"><link rel="prefetch" href="/assets/js/17.49ac8e1a.js"><link rel="prefetch" href="/assets/js/18.2fc85019.js"><link rel="prefetch" href="/assets/js/19.eab16a2f.js"><link rel="prefetch" href="/assets/js/20.656e1424.js"><link rel="prefetch" href="/assets/js/21.d475564f.js"><link rel="prefetch" href="/assets/js/22.fbce710a.js"><link rel="prefetch" href="/assets/js/23.0e11ca0d.js"><link rel="prefetch" href="/assets/js/3.36e6c52f.js"><link rel="prefetch" href="/assets/js/4.dbbfc7ac.js"><link rel="prefetch" href="/assets/js/5.1efdb115.js"><link rel="prefetch" href="/assets/js/6.6feef2bf.js"><link rel="prefetch" href="/assets/js/7.4b590157.js"><link rel="prefetch" href="/assets/js/9.623af976.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a509abab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/babe.png" alt="ğŸ’«Viaã®blog" class="logo"> <span class="site-name can-hide">ğŸ’«Viaã®blog</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic ğŸ³" class="dropdown-title"><span class="title">Basic ğŸ³</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic ğŸ³" class="mobile-dropdown-title"><span class="title">Basic ğŸ³</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/javascript.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/pages/react.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  React
</a></li><li class="dropdown-item"><!----> <a href="/pages/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/pages/webpack.html" class="nav-link">
  Webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web ğŸŒ" class="dropdown-title"><span class="title">Web ğŸŒ</span> <span class="arrow down"></span></button> <button type="button" aria-label="Web ğŸŒ" class="mobile-dropdown-title"><span class="title">Web ğŸŒ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/http.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/pages/security.html" class="nav-link">
  å®‰å…¨
</a></li><li class="dropdown-item"><!----> <a href="/pages/browser.html" class="nav-link">
  æµè§ˆå™¨
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog âœğŸ»" class="dropdown-title"><span class="title">Blog âœğŸ»</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog âœğŸ»" class="mobile-dropdown-title"><span class="title">Blog âœğŸ»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/interview.html" class="nav-link">
  é¢è¯• ğŸ“–
</a></li><li class="dropdown-item"><!----> <a href="/pages/blog.html" class="nav-link">
  åšå®¢ âœğŸ»
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Basic ğŸ³" class="dropdown-title"><span class="title">Basic ğŸ³</span> <span class="arrow down"></span></button> <button type="button" aria-label="Basic ğŸ³" class="mobile-dropdown-title"><span class="title">Basic ğŸ³</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/javascript.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/pages/react.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  React
</a></li><li class="dropdown-item"><!----> <a href="/pages/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/pages/webpack.html" class="nav-link">
  Webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web ğŸŒ" class="dropdown-title"><span class="title">Web ğŸŒ</span> <span class="arrow down"></span></button> <button type="button" aria-label="Web ğŸŒ" class="mobile-dropdown-title"><span class="title">Web ğŸŒ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/http.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/pages/security.html" class="nav-link">
  å®‰å…¨
</a></li><li class="dropdown-item"><!----> <a href="/pages/browser.html" class="nav-link">
  æµè§ˆå™¨
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog âœğŸ»" class="dropdown-title"><span class="title">Blog âœğŸ»</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog âœğŸ»" class="mobile-dropdown-title"><span class="title">Blog âœğŸ»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/interview.html" class="nav-link">
  é¢è¯• ğŸ“–
</a></li><li class="dropdown-item"><!----> <a href="/pages/blog.html" class="nav-link">
  åšå®¢ âœğŸ»
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/react.html#jsx" class="sidebar-link">Jsx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/react.html#react-createelement" class="sidebar-link">React.createElement</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#react-component" class="sidebar-link">React Component</a></li></ul></li><li><a href="/pages/react.html#children-ç›¸å…³-api" class="sidebar-link">Children ç›¸å…³ API</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/react.html#å•é¡¹æ•°æ®æµ" class="sidebar-link">å•é¡¹æ•°æ®æµ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/react.html#ç”Ÿå‘½å‘¨æœŸ" class="sidebar-link">ç”Ÿå‘½å‘¨æœŸ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/react.html#getsnapshotbeforeupdate" class="sidebar-link">getSnapshotBeforeUpdate</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#useeffect-å’Œ-uselayouteffect-å’Œ-componentdidmount" class="sidebar-link">useEffect å’Œ useLayoutEffect å’Œ componentDidMount</a></li></ul></li><li><a href="/pages/react.html#_15vs16" class="sidebar-link">15vs16</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/react.html#æ›´æ–°è¿‡ç¨‹" class="sidebar-link">æ›´æ–°è¿‡ç¨‹</a></li></ul></li><li><a href="/pages/react.html#fiber" class="sidebar-link">Fiber</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/react.html#fiber-èŠ‚ç‚¹-åŠ¨æ€å·¥ä½œå•å…ƒ" class="sidebar-link">fiber èŠ‚ç‚¹â€”â€”åŠ¨æ€å·¥ä½œå•å…ƒ</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#fiber-æ¶æ„" class="sidebar-link">fiber æ¶æ„</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#é¦–å±æ¸²æŸ“ã€æ›´æ–°åŒºåˆ«" class="sidebar-link">é¦–å±æ¸²æŸ“ã€æ›´æ–°åŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#context" class="sidebar-link">Context</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#å¼ºåˆ¶é‡æ–°æ¸²æŸ“" class="sidebar-link">å¼ºåˆ¶é‡æ–°æ¸²æŸ“</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#suspense" class="sidebar-link">Suspense</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#dangerouslysetinnerhtml" class="sidebar-link">dangerouslySetInnerHTML</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#diff-ç®—æ³•" class="sidebar-link">diff ç®—æ³•</a></li></ul></li><li><a href="/pages/react.html#hooks" class="sidebar-link">Hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/react.html#ä»£æ•°æ•ˆåº”" class="sidebar-link">ä»£æ•°æ•ˆåº”</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#useeffect" class="sidebar-link">useEffect</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#usecallback-å’Œ-usememo-åŒºåˆ«" class="sidebar-link">useCallback å’Œ useMemo åŒºåˆ«</a></li></ul></li><li><a href="/pages/react.html#react-ä¸­çš„æ€§èƒ½ä¼˜åŒ–" class="sidebar-link">React ä¸­çš„æ€§èƒ½ä¼˜åŒ–</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/react.html#æ€§èƒ½ä¼˜åŒ–åŸåˆ™" class="sidebar-link">æ€§èƒ½ä¼˜åŒ–åŸåˆ™ï¼š</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#ä¸ä½¿ç”¨-api" class="sidebar-link">ä¸ä½¿ç”¨ api</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#ç›¸å…³-api" class="sidebar-link">ç›¸å…³ api</a></li><li class="sidebar-sub-header"><a href="/pages/react.html#æ¸²æŸ“æ§åˆ¶" class="sidebar-link">æ¸²æŸ“æ§åˆ¶</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react"><a href="#react" class="header-anchor">#</a> React</h1> <h2 id="jsx"><a href="#jsx" class="header-anchor">#</a> Jsx</h2> <p>react ä¸­ï¼Œç»è¿‡ babel ç¼–è¯‘--&gt;React.createElement(react 17 ä¸éœ€è¦æ˜¾å¼å¯¼å…¥ react)<br>
React DOM åœ¨æ¸²æŸ“æ‰€æœ‰è¾“å…¥å†…å®¹ä¹‹å‰ï¼Œé»˜è®¤ä¼šè¿›è¡Œè½¬ä¹‰ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°é˜²æ­¢ XSSï¼ˆcross-site-scripting, è·¨ç«™è„šæœ¬ï¼‰æ”»å‡»ã€‚<br>
å¯é€šè¿‡@babel/plugin-transform-react-jsx (opens new window)æ’ä»¶æ˜¾å¼å‘Šè¯‰ Babel ç¼–è¯‘æ—¶éœ€è¦å°† JSX ç¼–è¯‘ä¸ºä»€ä¹ˆå‡½æ•°çš„è°ƒç”¨ï¼ˆé»˜è®¤ä¸º React.createElementï¼‰ã€‚</p> <h3 id="react-createelement"><a href="#react-createelement" class="header-anchor">#</a> React.createElement</h3> <p>createElement æ–¹æ³•ä¼šåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜æ”¾ç»„ä»¶çš„ä¿¡æ¯ï¼Œå…¶$$typeof ä¸º'REACT_ELEMENT_TYPE'<br>
React.isValidElement()æ£€æµ‹æ˜¯å¦ä¸ºåˆæ³•ç»„ä»¶</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isValidElement</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token keyword">typeof</span> object <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span>
    object <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
    object<span class="token punctuation">.</span>$$<span class="token keyword">typeof</span> <span class="token operator">===</span> <span class="token constant">REACT_ELEMENT_TYPE</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="react-component"><a href="#react-component" class="header-anchor">#</a> React Component</h3> <p>åŒºåˆ†å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶ï¼š</p> <ol><li>XXX.prototype.isReactComponent æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨â€”â€”â€”â€”ç±»ç»„ä»¶ï¼Œä¸å­˜åœ¨â€”â€”â€”â€”å‡½æ•°ç»„ä»¶</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ClassComponent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isReactComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ClassComponentæ˜¯ç±»ç»„ä»¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ClassComponentå‡½æ•°å¼ç»„ä»¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>instanceof React.Component trueâ€”â€”â€”â€”ç±»ç»„ä»¶ï¼Œfalseâ€”â€”â€”â€”å‡½æ•°ç»„ä»¶</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> clas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ClassComponent is Class  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>clas <span class="token keyword">instanceof</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>

<span class="token keyword">const</span> func <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FunctionComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">FunctionComponent is Class  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>func <span class="token keyword">instanceof</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
</code></pre></div><h2 id="children-ç›¸å…³-api"><a href="#children-ç›¸å…³-api" class="header-anchor">#</a> Children ç›¸å…³ API</h2> <p>React.isValidElement(item) åˆ¤æ–­æ˜¯å¦ react element
React.Children.only å­èŠ‚ç‚¹æ˜¯å¦å•ä¸€
React.Children.forEach éå†å­èŠ‚ç‚¹
React.Children.forEachÂ =Â React.Children.toArrayÂ +Â Array.prototype.forEach</p> <blockquote><p>é€šå¸¸ä¸ React.cloneElement()ä¸€èµ·ä½¿ç”¨æ“ä½œ children,æ³¨å…¥æ–°çš„å±æ€§</p></blockquote> <h2 id="å•é¡¹æ•°æ®æµ"><a href="#å•é¡¹æ•°æ®æµ" class="header-anchor">#</a> å•é¡¹æ•°æ®æµ</h2> <ol><li>ç»„ä»¶é—´ props æ˜¯åªè¯»çš„ï¼Œè‡ªé¡¶å‘ä¸‹ï¼Œæµå‘å•ä¸€ã€‚</li> <li>æ•°æ®æ”¹å˜é©±åŠ¨è§†å›¾æ”¹å˜ï¼Œè€Œè§†å›¾å˜åŒ–éœ€è¦æ‰‹åŠ¨æ›´æ–°çŠ¶æ€</li></ol> <h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> ç”Ÿå‘½å‘¨æœŸ</h2> <p><img src="/assets/img/lifeCycle.cac7e5e5.png" alt="LifeCycle">
é”™è¯¯å¤„ç†ï¼š<br>
static getDerivedStateFromError(error) render é˜¶æ®µï¼Œä¸å¯æœ‰å‰¯ä½œç”¨<br>
componentDidCatch() commit é˜¶æ®µï¼Œå¯æœ‰å‰¯ä½œç”¨<br>
componentDidUpdate ä¸ useEffect æ— ä¾èµ–ç±»ä¼¼ï¼Œæ¯ä¸€æ¬¡æ‰§è¡Œå‡½æ•°ç»„ä»¶éƒ½ä¼šæ‰§è¡Œ</p> <h3 id="getsnapshotbeforeupdate"><a href="#getsnapshotbeforeupdate" class="header-anchor">#</a> getSnapshotBeforeUpdate</h3> <p>è·å–æ›´æ–°å‰ DOM ä¿¡æ¯çš„æœ€ä½³æ—¶æœŸï¼Œå¯è¿›è¡Œå’Œ dom ç›¸å…³çš„è®¡ç®—
return ä¸€ä¸ªå¿«ç…§ä½œä¸º componentDidUpdate çš„ç¬¬ä¸‰ä¸ªå‚æ•°</p> <h3 id="useeffect-å’Œ-uselayouteffect-å’Œ-componentdidmount"><a href="#useeffect-å’Œ-uselayouteffect-å’Œ-componentdidmount" class="header-anchor">#</a> useEffect å’Œ useLayoutEffect å’Œ componentDidMount</h3> <p>useEffect åœ¨ commit é˜¶æ®µçš„ layout å­é˜¶æ®µç»“æŸåå¼‚æ­¥è°ƒç”¨ï¼ˆæ¸²æŸ“åè°ƒç”¨ï¼‰<br>
componentDidMount å’Œ useLayoutEffectï¼šcommit çš„ layout é˜¶æ®µåŒæ­¥è°ƒç”¨ï¼ˆæ¸²æŸ“å‰è°ƒç”¨ï¼‰</p> <h2 id="_15vs16"><a href="#_15vs16" class="header-anchor">#</a> 15vs16</h2> <h3 id="æ›´æ–°è¿‡ç¨‹"><a href="#æ›´æ–°è¿‡ç¨‹" class="header-anchor">#</a> æ›´æ–°è¿‡ç¨‹</h3> <p>15ï¼šåŒæ­¥ä¸å¯ä¸­æ–­</p> <ul><li>Reconcilerï¼ˆåè°ƒå™¨ï¼‰â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶</li> <li>Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚é€’å½’å¤„ç†è™šæ‹Ÿ DOMã€‚</li></ul> <p>16ï¼šå¼‚æ­¥å¯ä¸­æ–­</p> <ul><li>Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰â€”â€” è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜ä»»åŠ¡ä¼˜å…ˆè¿›å…¥ Reconciler<br>
æ¨¡æ‹Ÿ requestIdleCallbackã€‚ä¸ç›´æ¥ä½¿ç”¨çš„åŸå› ï¼šæµè§ˆå™¨å…¼å®¹æ€§ï¼›è§¦å‘é¢‘ç‡ä¸ç¨³å®šï¼ˆåˆ‡æ¢ tabï¼‰ã€‚</li> <li>Reconcilerï¼ˆåè°ƒå™¨ï¼‰â€”â€” è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶<br>
è°ƒç”¨ shouldYieldï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å‰©ä½™æ—¶é—´ï¼Œæ ‡è®°æœ‰æ”¹å˜çš„è™šæ‹Ÿ dom</li> <li>Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰â€”â€” è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š</li></ul> <h2 id="fiber"><a href="#fiber" class="header-anchor">#</a> Fiber</h2> <h3 id="fiber-èŠ‚ç‚¹-åŠ¨æ€å·¥ä½œå•å…ƒ"><a href="#fiber-èŠ‚ç‚¹-åŠ¨æ€å·¥ä½œå•å…ƒ" class="header-anchor">#</a> fiber èŠ‚ç‚¹â€”â€”åŠ¨æ€å·¥ä½œå•å…ƒ</h3> <p>ReactElement â€”â€” reconciler â€”â€”&gt; fiber<br>
14 ä¸­ fiber ç±»å‹ï¼Œå…³ç³»æœ‰ä¸‰ç§ï¼šchildï¼Œreturnï¼Œsibling</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> FunctionComponent <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// å‡½æ•°ç»„ä»¶</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> ClassComponent <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// ç±»ç»„ä»¶</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> IndeterminateComponent <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// åˆå§‹åŒ–çš„æ—¶å€™ä¸çŸ¥é“æ˜¯å‡½æ•°ç»„ä»¶è¿˜æ˜¯ç±»ç»„ä»¶</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> HostRoot <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// Root Fiber å¯ä»¥ç†è§£ä¸ºæ ¹å…ƒç´  ï¼Œ é€šè¿‡reactDom.render()äº§ç”Ÿçš„æ ¹å…ƒç´ </span>
<span class="token keyword">export</span> <span class="token keyword">const</span> HostPortal <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº”  ReactDOM.createPortal äº§ç”Ÿçš„ Portal</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> HostComponent <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// dom å…ƒç´  æ¯”å¦‚ &lt;div&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> HostText <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// æ–‡æœ¬èŠ‚ç‚¹</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> Fragment <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº” &lt;React.Fragment&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> Mode <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº” &lt;React.StrictMode&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> ContextConsumer <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº” &lt;Context.Consumer&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> ContextProvider <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº” &lt;Context.Provider&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> ForwardRef <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº” React.ForwardRef</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> Profiler <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº” &lt;Profiler/ &gt;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> SuspenseComponent <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº” &lt;Suspense&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> MemoComponent <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº” React.memo è¿”å›çš„ç»„ä»¶</span>
</code></pre></div><h3 id="fiber-æ¶æ„"><a href="#fiber-æ¶æ„" class="header-anchor">#</a> fiber æ¶æ„</h3> <p>åŒç¼“å­˜ï¼šåœ¨å†…å­˜ä¸­æ„å»ºï¼Œç›´æ¥æ›¿æ¢<br>
ç‰¹ç‚¹ï¼šæ›´æ–°å¯ä¸­æ–­å¯ç»§ç»­ï¼Œå¯è®¾ç½®ä¼˜å…ˆçº§<br>
fiberâ€”â€”çº¤ç¨‹ï¼Œç†è§£ä¸ºåç¨‹çš„ä¸€ç§å®ç°ï¼Œjs ä¸­åç¨‹çš„å®ç°ï¼šgenerator<br>
ä¸ä½¿ç”¨ generator çš„åŸå› ï¼š</p> <ul><li>æœ‰ä¼ æŸ“æ€§ï¼Œå½“æŸä¸ªå‡½æ•°å˜ä¸º generator åï¼Œè¯¥å‡½æ•°è°ƒç”¨é“¾ä¸Šçš„å…¶ä»–å‡½æ•°ä¼šæœ‰å½±å“</li> <li>æ— æ³•å®ç°ä¼˜å…ˆçº§ã€‚Generator æ‰§è¡Œçš„ä¸­é—´çŠ¶æ€æ˜¯ä¸Šä¸‹æ–‡å…³è”çš„ã€‚</li></ul> <p>é¦–æ¬¡è°ƒç”¨ ReactDOM.renderâ€”â€”åˆ›å»º FiberRootNode(æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹)<br>
â€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒâ€ƒ â†“ current Fiber æ ‘(å½“å‰é¡µé¢å†…å®¹)<br>
ä¹‹åè°ƒç”¨ ReactDOM.renderâ€”â€”åˆ›å»º RootFiber(å½“å‰åº”ç”¨çš„æ ¹èŠ‚ç‚¹)</p> <h3 id="é¦–å±æ¸²æŸ“ã€æ›´æ–°åŒºåˆ«"><a href="#é¦–å±æ¸²æŸ“ã€æ›´æ–°åŒºåˆ«" class="header-anchor">#</a> é¦–å±æ¸²æŸ“ã€æ›´æ–°åŒºåˆ«</h3> <p>é¦–å±æ¸²æŸ“ä¸æ›´æ–°çš„åŒºåˆ«ï¼Œé¦–å±æ¸²æŸ“åˆ›å»º fiber æ ‘çš„è¿‡ç¨‹æ²¡æœ‰ diff ç®—æ³•<br>
å¯¹äºä¸¤æ£µæ ‘éƒ½å­˜åœ¨çš„ fiber èŠ‚ç‚¹ç”¨ alternate å±æ€§è¿æ¥<br>
è‹¥ rootFiber æœ‰ alternate æŒ‡å‘ï¼Œåˆ™ä¼šåŸºäºè¯¥æŒ‡å‘æ ‘åˆ›å»º workInProgress Fiber æ ‘ã€‚<br>
å°† alternate æŒ‡å‘çš„ current fiber å’Œå½“å‰è¿”å›çš„ jsx ç»“æ„åšå¯¹æ¯”ï¼Œç”Ÿæˆ workInProgress Fiber æ ‘çš„è¿‡ç¨‹å°±æ˜¯è¿›è¡Œ<code>diffç®—æ³•</code>ã€‚<br>
workInProgress Fiber æ ‘ commit åæˆä¸º FiberRootNode çš„ current æŒ‡å‘ï¼Œå³å˜æˆ current æ ‘ã€‚</p> <h3 id="context"><a href="#context" class="header-anchor">#</a> Context</h3> <h4 id="createcontext"><a href="#createcontext" class="header-anchor">#</a> createContext</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token punctuation">{</span>
  $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token constant">REACT_CONTEXT_TYPE</span><span class="token punctuation">,</span>
  _currentValue<span class="token operator">:</span> defaultValue<span class="token punctuation">,</span>
  Provider<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  Consumer<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span>Provider <span class="token operator">=</span> <span class="token punctuation">{</span>
  $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token constant">REACT_PROVIDER_TYPE</span><span class="token punctuation">,</span>
  _context<span class="token operator">:</span> context<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span>Consumer <span class="token operator">=</span> <span class="token punctuation">{</span>
  $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token constant">REACT_CONTEXT_TYPE</span><span class="token punctuation">,</span>
  _context<span class="token operator">:</span> context<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="å¼ºåˆ¶é‡æ–°æ¸²æŸ“"><a href="#å¼ºåˆ¶é‡æ–°æ¸²æŸ“" class="header-anchor">#</a> å¼ºåˆ¶é‡æ–°æ¸²æŸ“</h3> <ol><li>forceUpdateï¼š<br>
å¦‚æœç»„ä»¶è°ƒç”¨ forceUpdate,åˆ™å…¨å±€çš„ hasForceUpdate=trueï¼Œç»„ä»¶æ›´æ–°å‰æ£€æŸ¥å¦‚æœä¸º trueï¼Œåˆ™è·³è¿‡ PureComponent çš„æµ…æ¯”è¾ƒå’Œ shouldComponentUpdate è‡ªå®šä¹‰æ¯”è¾ƒï¼Œç›´æ¥æ›´æ–°</li> <li>context çš„æ›´æ–°</li></ol> <h3 id="suspense"><a href="#suspense" class="header-anchor">#</a> Suspense</h3> <p>Suspense åœ¨æ‰§è¡Œå†…éƒ¨å¯ä»¥é€šè¿‡ try{}catch{} æ–¹å¼æ•è·å¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸é€šå¸¸æ˜¯ä¸€ä¸ª Promise ï¼Œå¯ä»¥åœ¨è¿™ä¸ª Promise ä¸­è¿›è¡Œæ•°æ®è¯·æ±‚å·¥ä½œï¼ŒSuspense å†…éƒ¨ä¼šå¤„ç†è¿™ä¸ª Promise ï¼ŒPromise ç»“æŸåï¼ŒSuspense ä¼šå†ä¸€æ¬¡é‡æ–° render æŠŠæ•°æ®æ¸²æŸ“å‡ºæ¥ï¼Œè¾¾åˆ°å¼‚æ­¥æ¸²æŸ“çš„æ•ˆæœã€‚</p> <h3 id="dangerouslysetinnerhtml"><a href="#dangerouslysetinnerhtml" class="header-anchor">#</a> dangerouslySetInnerHTML</h3> <p>dangerouslySetInnerHTML æ˜¯ React ä¸ºæµè§ˆå™¨ DOM æä¾› innerHTML çš„æ›¿æ¢æ–¹æ¡ˆã€‚ç›´æ¥è®¾ç½® HTML å­˜åœ¨é£é™©(xss æ”»å‡»)ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>div dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> __html<span class="token operator">:</span> <span class="token string">'&lt;a href=&quot;&quot;&gt;è·³è½¬&lt;/a&gt;'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><p>å†…å®¹ä¸èƒ½åŒ…å« react ç»„ä»¶ï¼Œå¦‚æœåŒ…å«ï¼Œéœ€è¦ç”¨ ReactDom.render åŒ…è£¹æ¸²æŸ“</p> <h3 id="diff-ç®—æ³•"><a href="#diff-ç®—æ³•" class="header-anchor">#</a> diff ç®—æ³•</h3> <p>å¯¹æ¯”æ›´æ–°å‰åçš„ nodeList,ä¸º node æ ‡è®° flag,éœ€è¦è€ƒè™‘æ˜¯ä»¥ä¸‹ä¸‰ç§æƒ…å†µçš„å“ªç§æƒ…å†µï¼š</p> <ol><li>èŠ‚ç‚¹å¢åˆ </li> <li>èŠ‚ç‚¹å±æ€§å˜åŒ–</li> <li>èŠ‚ç‚¹ä½ç½®ç§»åŠ¨</li></ol> <p>ä¸‰ç§æƒ…å†µçš„å¤„ç†é€»è¾‘ä¸åŒï¼Œæƒ…å†µ 1&amp;2 å±äºå¸¸è§æƒ…å†µï¼Œ3 ä¸å¸¸è§ã€‚<br>
ç»å†å¤šè½®éå†ï¼Œä¼˜å…ˆå¤„ç†å¸¸è§æƒ…å†µï¼Œåå¤„ç†ä¸å¸¸è§æƒ…å†µã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è™šæ‹ŸdomèŠ‚ç‚¹æ•°æ®ç»“æ„</span>
type flag <span class="token operator">=</span> <span class="token string">&quot;Placement&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;Deletion&quot;</span><span class="token punctuation">;</span> <span class="token comment">//Placementæ–°å¢æˆ–ç§»åŠ¨ï¼ŒDeletionåˆ é™¤</span>
<span class="token keyword">interface</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
  key<span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">//nodeçš„å”¯ä¸€æ ‡è¯†</span>
  flag<span class="token operator">?</span><span class="token operator">:</span> Flag<span class="token punctuation">;</span> <span class="token comment">// æ ‡è®°æ“ä½œç±»å‹</span>
  index<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">//è¯¥nodeåœ¨åŒçº§nodeä¸­çš„ç´¢å¼•ä½ç½®</span>
<span class="token punctuation">}</span>

type NodeList <span class="token operator">=</span> Node<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">diff</span><span class="token punctuation">(</span><span class="token parameter">before<span class="token operator">:</span> NodeList<span class="token punctuation">,</span> after<span class="token operator">:</span> NodeList</span><span class="token punctuation">)</span><span class="token operator">:</span> NodeList <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result<span class="token operator">:</span>NodeList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// éå†å‰å‡†å¤‡å·¥ä½œ</span>
  <span class="token comment">// 1.éœ€è¦å­˜ä¸€ä»½beforeNode,ä¸”ä»¥O(1)å¤æ‚åº¦å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„node</span>
  <span class="token keyword">const</span> beforeMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token operator">&lt;</span>string<span class="token punctuation">,</span>Node<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  before<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span>i</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    node<span class="token punctuation">.</span>index<span class="token operator">=</span>i<span class="token punctuation">;</span>
    beforeMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>key<span class="token punctuation">,</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.éå†after,å¯¹æ¯”beforeï¼Œafterï¼Œéƒ½å­˜åœ¨çš„nodeï¼Œå¯å¤ç”¨ï¼Œå°†å­˜åœ¨ä¸¤ç§æƒ…å†µï¼šç§»åŠ¨ã€ä¸ç§»åŠ¨ï¼Œå¦‚ä½•åˆ¤æ–­ï¼Ÿ</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>after<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// éå†é€»è¾‘</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>demo1:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ›´æ–°å‰</span>
<span class="token keyword">const</span> before <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&quot;a&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// æ›´æ–°å</span>
<span class="token keyword">const</span> after <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&quot;d&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">diff</span><span class="token punctuation">(</span>before<span class="token punctuation">,</span> after<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
[
  {key:'a',flag:&quot;Deletion&quot;},
  {key:'d',flag:&quot;Placement&quot;}
]
*/</span>
</code></pre></div><p>demo2:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ›´æ–°å‰</span>
<span class="token keyword">const</span> before <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>key<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>key<span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>key<span class="token operator">:</span> <span class="token string">'c'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token comment">// æ›´æ–°å</span>
<span class="token keyword">const</span> after <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>key<span class="token operator">:</span> <span class="token string">'c'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>key<span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>key<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token function">diff</span><span class="token punctuation">(</span>before<span class="token punctuation">,</span> after<span class="token punctuation">)</span> è¾“å‡º
<span class="token comment">/*
[
  {key: &quot;b&quot;, flag: &quot;Placement&quot;},
  {key: &quot;a&quot;, flag: &quot;Placement&quot;}
]

ç”±äºbä¹‹å‰å·²ç»å­˜åœ¨ï¼Œ{key: &quot;b&quot;, flag: &quot;Placement&quot;}ä»£è¡¨bå¯¹åº”DOMéœ€è¦å‘åç§»åŠ¨ï¼ˆå¯¹åº”parentNode.appendChildæ–¹æ³•ï¼‰ã€‚abcç»è¿‡è¯¥æ“ä½œåå˜ä¸ºacbã€‚

ç”±äºaä¹‹å‰å·²ç»å­˜åœ¨ï¼Œ{key: &quot;a&quot;, flag: &quot;Placement&quot;}ä»£è¡¨aå¯¹åº”DOMéœ€è¦å‘åç§»åŠ¨ã€‚acbç»è¿‡è¯¥æ“ä½œåå˜ä¸ºcbaã€‚

æ‰§è¡Œåçš„ç»“æœå°±æ˜¯ï¼šé¡µé¢ä¸­çš„abcå˜ä¸ºcbaã€‚
*/</span>
</code></pre></div><p>æœªå®Œ...</p> <h2 id="hooks"><a href="#hooks" class="header-anchor">#</a> Hooks</h2> <h3 id="ä»£æ•°æ•ˆåº”"><a href="#ä»£æ•°æ•ˆåº”" class="header-anchor">#</a> ä»£æ•°æ•ˆåº”</h3> <p>hooks æ€æƒ³ï¼šå°†å‰¯ä½œç”¨ä»å‡½æ•°ä¸­åˆ†ç¦»ï¼Œä½¿å‡½æ•°åŠŸèƒ½çº¯ç²¹ã€‚</p> <h3 id="useeffect"><a href="#useeffect" class="header-anchor">#</a> useEffect</h3> <p>åœ¨ fiber èŠ‚ç‚¹ä¸Šç»´æŠ¤äº†ä¸€ä¸ªé“¾è¡¨(memorizedState)ï¼Œæ¯ä¸ª hooks éƒ½åœ¨å¯¹åº”çš„é“¾è¡¨å…ƒç´ ä¸Šå­˜å–æ•°æ®ï¼Œæ¯ä¸ª hooks æœ‰ mount å’Œ update ä¸¤ä¸ªé˜¶æ®µã€‚<br> <strong>areHookInputsEqual</strong>å‡½æ•°ç”¨æ¥å¤„ç†ç¬¬äºŒä¸ªå‚æ•°ï¼š</p> <ul><li>å½“çƒ­æ›´æ–°çš„æ—¶å€™ï¼Œå°±ç®—ä¾èµ–æ²¡æœ‰å˜ï¼Œä¹Ÿéœ€è¦é‡æ–°æ‰§è¡Œ effectï¼Œè¿™ä¸ªæ˜¯é€šè¿‡ ignorePreviousDependencies å˜é‡æ¥æ§åˆ¶çš„ã€‚</li> <li>deps ä¸ä¸Šä¸€ä¸ª deps æœ€å¯¹æ¯”ï¼Œä¸ä¸€æ ·åˆ™è¿”å› falseï¼Œè§¦å‘æ›´æ–°ï¼Œå¦‚æœ prevDeps æ˜¯ nullï¼Œç›´æ¥è¿”å› falseï¼Œå› æ­¤ useEffect ç¬¬äºŒä¸ªå‚æ•°ä¼  undefined æˆ–è€… null çš„è¯ effect å‡½æ•°éƒ½ä¼šæ‰§è¡Œã€‚</li></ul> <h3 id="usecallback-å’Œ-usememo-åŒºåˆ«"><a href="#usecallback-å’Œ-usememo-åŒºåˆ«" class="header-anchor">#</a> useCallback å’Œ useMemo åŒºåˆ«</h3> <p>useCallback ç¼“å­˜ç¬¬ä¸€ä¸ªå‚æ•°ï¼›<br>
useMemo æ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç¼“å­˜å…¶ç»“æœã€‚</p> <h2 id="react-ä¸­çš„æ€§èƒ½ä¼˜åŒ–"><a href="#react-ä¸­çš„æ€§èƒ½ä¼˜åŒ–" class="header-anchor">#</a> React ä¸­çš„æ€§èƒ½ä¼˜åŒ–</h2> <h3 id="æ€§èƒ½ä¼˜åŒ–åŸåˆ™"><a href="#æ€§èƒ½ä¼˜åŒ–åŸåˆ™" class="header-anchor">#</a> æ€§èƒ½ä¼˜åŒ–åŸåˆ™ï¼š</h3> <p>å½“çˆ¶ç»„ä»¶æ»¡è¶³æ€§èƒ½ä¼˜åŒ–æ¡ä»¶(state ä¸å˜--&gt;props ä¸å˜) eagerState ç­–ç•¥<br>
å­å­™ç»„ä»¶å¯èƒ½å‘½ä¸­æ€§èƒ½ä¼˜åŒ–(å­ç»„ä»¶çš„ state&amp;context ä¸å˜æ—¶å‘½ä¸­) bailout ç­–ç•¥<br>
ä¸‰è€…éƒ½ä¸å˜åˆ™ä¸ä¼šé‡æ–°æ¸²æŸ“</p> <h4 id="å¦‚ä½•æ¯”è¾ƒ-props-æ˜¯å¦æ”¹å˜"><a href="#å¦‚ä½•æ¯”è¾ƒ-props-æ˜¯å¦æ”¹å˜" class="header-anchor">#</a> å¦‚ä½•æ¯”è¾ƒ props æ˜¯å¦æ”¹å˜</h4> <ul><li>å…¨ç­‰æ¯”è¾ƒ é«˜æ•ˆï¼Œä½†ä¸æ˜“å‘½ä¸­ ï¼ˆreact é»˜è®¤ï¼‰O(1)</li> <li>æµ…æ¯”è¾ƒ éå†å¯¹è±¡ key/value ä¸é«˜æ•ˆï¼Œä½†æ˜“å‘½ä¸­ ï¼ˆmemoï¼‰O(n)</li></ul> <p>ä¸ºä»€ä¹ˆçˆ¶ç»„ä»¶ states å˜å­ç»„ä»¶ props å°±ä¸€å®šæ”¹å˜?<br>
å› ä¸ºå­ç»„ä»¶ props æ°¸è¿œæ˜¯ä¸€ä¸ªæ–°çš„{}ï¼Œ{}!=={}<br>
æ ¹ç»„ä»¶çš„ props æ°¸è¿œä¸å˜ã€‚</p> <p>react é‡æ–°æ¸²æŸ“ä¼šé‡æ–°æ„å»ºæ•´æ£µæ ‘ï¼Œé€’å½’éå†æ¯ä¸ªèŠ‚ç‚¹ï¼Œæ¯æ¬¡è®¿é—®èŠ‚ç‚¹éƒ½ä¼šæœ‰ä¸¤ä¸ªå›è°ƒï¼š<br>
é€’ï¼šæ¯æ¬¡è®¿é—®èŠ‚ç‚¹ä¼šè°ƒç”¨ <code>beginWork</code>ï¼Œå¤„ç† newProps å’Œ oldProps çš„å¯¹æ¯”ç­‰<br>
å½’ï¼šç›´è‡³è®¿é—®åˆ°æ²¡æœ‰å­èŠ‚ç‚¹çš„ç»„ä»¶ï¼Œåˆ™å‘ä¸Šå›å½’ï¼Œä¾æ¬¡è°ƒç”¨ <code>completeWork</code></p> <h3 id="ä¸ä½¿ç”¨-api"><a href="#ä¸ä½¿ç”¨-api" class="header-anchor">#</a> ä¸ä½¿ç”¨ api</h3> <p>æŠŠå˜çš„éƒ¨åˆ†å’Œä¸å˜çš„éƒ¨åˆ†åˆ†ç¦»ï¼ˆprops,state,contextï¼‰</p> <ul><li>æ‹†åˆ†ä¸ºä¸¤ä¸ªç»„ä»¶</li> <li>ä¸å¿…é‡æ–°æ¸²æŸ“ç»„ä»¶æ”¾åœ¨ children é‡Œ</li></ul> <h3 id="ç›¸å…³-api"><a href="#ç›¸å…³-api" class="header-anchor">#</a> ç›¸å…³ api</h3> <h4 id="purecomponent"><a href="#purecomponent" class="header-anchor">#</a> PureComponent</h4> <p>æµ…æ¯”è¾ƒ state å’Œ props æ˜¯å¦ç›¸ç­‰ï¼›
shouldComponentUpdate çš„æƒé‡ï¼Œå¤§äº PureComponentï¼›
æ›´æ–°é˜¶æ®µå¯¹ state å’Œ props çš„æ¯”è¾ƒï¼Œç”¨äº† <em>shallowEqual</em> å‡½æ•°ï¼š</p> <ol><li>åˆ¤æ–­æ–°è€ state/props æ˜¯å¦ç›¸ç­‰</li> <li>æ–°è€ state/props æ˜¯å¦ä¸ºéå¯¹è±¡/null</li> <li>æ–°è€ state/props çš„ keys é•¿åº¦æ˜¯å¦ç›¸ç­‰</li> <li>éå†è€ state/propsï¼Œå¯¹æ¯”å¯¹åº”æ–° state/props çš„å€¼æ˜¯å¦ç›¸ç­‰</li></ol> <h4 id="react-memo"><a href="#react-memo" class="header-anchor">#</a> React.memo</h4> <p>æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶</p> <div class="language-js extra-class"><pre class="language-js"><code>React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> compare<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// compare è¿”å›trueï¼šç¼“å­˜ï¼Œfalseï¼šæ›´æ–°</span>
<span class="token comment">// shouldComponentUpdate è¿”å›trueï¼šæ›´æ–°ï¼Œfalseï¼šç¼“å­˜</span>
<span class="token comment">// compare ä¸ä¼ -&gt;ä½¿ç”¨shallowEqualå‡½æ•°æµ…æ¯”è¾ƒprops</span>
</code></pre></div><h3 id="æ¸²æŸ“æ§åˆ¶"><a href="#æ¸²æŸ“æ§åˆ¶" class="header-anchor">#</a> æ¸²æŸ“æ§åˆ¶</h3> <p><img src="/assets/img/renderControl.09225c1d.png" alt="RenderControl">
æ§åˆ¶ render çš„æ–¹æ³•ï¼š</p> <ul><li>ä»çˆ¶ç»„ä»¶ç›´æ¥éš”æ–­å­ç»„ä»¶çš„æ¸²æŸ“ï¼Œç»å…¸çš„å°±æ˜¯ memoï¼Œç¼“å­˜ element å¯¹è±¡ã€‚</li> <li>ç»„ä»¶ä»è‡ªèº«æ¥æ§åˆ¶æ˜¯å¦ render ï¼Œæ¯”å¦‚ï¼šPureComponent ï¼ŒshouldComponentUpdateã€‚</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">11/30/2022, 10:39:48 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6a1e7b57.js" defer></script><script src="/assets/js/2.f7f94fda.js" defer></script><script src="/assets/js/8.74f87bb3.js" defer></script>
  </body>
</html>
